(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[376],{33363:function(e,r,s){Promise.resolve().then(s.bind(s,48974))},48974:function(e,r,s){"use strict";s.d(r,{TestPage:function(){return E}});var t=s(57437),a=s(2265),l=s(16463),n=s(53429),c=s(89733),i=s(36836),d=s(89172),o=s(69954),x=s(84573),m=s(3152),h=s(85130),u=s(11853);function g(e){var r,s;let{lang:l,onColorDetected:n,onClose:i,testId:g}=e,[b,p]=(0,a.useState)(null),[f,j]=(0,a.useState)([]),[y,v]=(0,a.useState)(null),[N,w]=(0,a.useState)(!1),[k,C]=(0,a.useState)(!1),[_,S]=(0,a.useState)(null),Z=(0,a.useRef)(null),T=(0,a.useRef)(null);(0,a.useRef)(null);let R=(0,a.useRef)(null);(0,d.nZ)(l);let z=(0,a.useCallback)(e=>{if(!e.type.startsWith("image/")){S("ar"===l?"يرجى اختيار ملف صورة صالح":"Please select a valid image file");return}if(e.size>10485760){S("ar"===l?"حجم الملف كبير جداً (الحد الأقصى 10 ميجابايت)":"File size too large (max 10MB)");return}S(null);let r=new FileReader;r.onload=e=>{var r;let s=null===(r=e.target)||void 0===r?void 0:r.result;p(s),I(s)},r.readAsDataURL(e)},[l]),I=(0,a.useCallback)(e=>{w(!0),S(null),R.current=setTimeout(()=>{console.error("Image analysis timeout after 30 seconds"),w(!1),S("ar"===l?"انتهت مهلة تحليل الصورة. يرجى المحاولة بصورة أصغر.":"Image analysis timeout. Please try with a smaller image.")},3e4);let r=new Image;r.onload=()=>{try{let e=T.current;if(!e)return;let s=e.getContext("2d");if(!s)return;e.width=r.width,e.height=r.height,s.drawImage(r,0,0);let t=D(s,r.width,r.height);j(t),w(!1),R.current&&(clearTimeout(R.current),R.current=null)}catch(e){console.error("Error during image analysis:",e),w(!1),S("ar"===l?"فشل في معالجة الصورة. يرجى المحاولة بصورة أخرى.":"Failed to process image. Please try another image."),R.current&&(clearTimeout(R.current),R.current=null)}},r.onerror=()=>{w(!1),S("ar"===l?"فشل في تحميل الصورة. يرجى التأكد من صحة الملف.":"Failed to load image. Please check the file is valid."),R.current&&(clearTimeout(R.current),R.current=null)},r.src=e},[l]),D=(e,r,s)=>{let t=e.getImageData(0,0,r,s).data,a=new Map;for(let e=0;e<t.length;e+=40){let s=t[e],l=t[e+1],n=t[e+2];if(t[e+3]<128)continue;let c="".concat(20*Math.floor(s/20),"-").concat(20*Math.floor(l/20),"-").concat(20*Math.floor(n/20)),i=e/4,d=i%r,o=Math.floor(i/r);if(a.has(c)){let e=a.get(c);e.count++,e.positions.push({x:d,y:o})}else a.set(c,{count:1,rgb:{r:s,g:l,b:n},positions:[{x:d,y:o}]})}return Array.from(a.entries()).sort((e,r)=>{let[,s]=e,[,t]=r;return t.count-s.count}).slice(0,5).map((e,r)=>{let[,s]=e,t=s.positions.reduce((e,r)=>({x:e.x+r.x,y:e.y+r.y}),{x:0,y:0});return t.x=Math.floor(t.x/s.positions.length),t.y=Math.floor(t.y/s.positions.length),{hex:P(s.rgb.r,s.rgb.g,s.rgb.b),rgb:s.rgb,position:t,confidence:Math.min(95,60+(0===r?35:25-5*r))}})},P=(e,r,s)=>"#"+(16777216+(e<<16)+(r<<8)+s).toString(16).slice(1),E=e=>{e.preventDefault(),e.stopPropagation(),"dragenter"===e.type||"dragover"===e.type?C(!0):"dragleave"===e.type&&C(!1)};return(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,t.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3 rtl:space-x-reverse",children:[(0,t.jsx)(o.Z,{className:"h-6 w-6 text-primary-600"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 dark:text-gray-100",children:"ar"===l?"تحليل اللون بالصورة":"Image Color Analysis"})]}),(0,t.jsx)(c.z,{variant:"ghost",onClick:i,children:(0,t.jsx)(x.Z,{className:"h-5 w-5"})})]}),(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsxs)("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-950 border border-blue-200 dark:border-blue-800 rounded-lg",children:[(0,t.jsx)("h3",{className:"font-medium text-blue-900 dark:text-blue-100 mb-2",children:"ar"===l?"تعليمات التصوير:":"Photography Guidelines:"}),(0,t.jsxs)("ul",{className:"text-sm text-blue-800 dark:text-blue-200 space-y-1",children:[(0,t.jsxs)("li",{children:["• ","ar"===l?"استخدم إضاءة جيدة وطبيعية":"Use good natural lighting"]}),(0,t.jsxs)("li",{children:["• ","ar"===l?"تأكد من وضوح الصورة":"Ensure image is clear and focused"]}),(0,t.jsxs)("li",{children:["• ","ar"===l?"اجعل العينة في وسط الصورة":"Center the sample in the image"]}),(0,t.jsxs)("li",{children:["• ","ar"===l?"تجنب الظلال والانعكاسات":"Avoid shadows and reflections"]})]})]}),b?(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)("canvas",{ref:T,onClick:e=>{let r=T.current;if(!r)return;let s=r.getBoundingClientRect(),t=Math.floor((e.clientX-s.left)*(r.width/s.width)),a=Math.floor((e.clientY-s.top)*(r.height/s.height)),l=r.getContext("2d");if(!l)return;let n=l.getImageData(t,a,1,1),c=n.data[0],i=n.data[1],d=n.data[2];v({hex:P(c,i,d),rgb:{r:c,g:i,b:d},position:{x:t,y:a},confidence:85})},className:"max-w-full h-auto border border-gray-300 dark:border-gray-600 rounded-lg cursor-crosshair",style:{maxHeight:"400px"}}),y&&(0,t.jsx)("div",{className:"absolute w-4 h-4 border-2 border-white rounded-full shadow-lg",style:{left:"".concat(y.position.x/((null===(r=T.current)||void 0===r?void 0:r.width)||1)*100,"%"),top:"".concat(y.position.y/((null===(s=T.current)||void 0===s?void 0:s.height)||1)*100,"%"),transform:"translate(-50%, -50%)"}})]}),N?(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-500",children:"ar"===l?"جاري تحليل الألوان...":"Analyzing colors..."})]}):(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4",children:"ar"===l?"الألوان المكتشفة:":"Detected Colors:"}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:f.map((e,r)=>(0,t.jsxs)("button",{onClick:()=>v(e),className:"p-3 rounded-lg border-2 transition-all ".concat((null==y?void 0:y.hex)===e.hex?"border-primary-500 ring-2 ring-primary-200":"border-gray-300 dark:border-gray-600 hover:border-primary-300"),children:[(0,t.jsx)("div",{className:"w-full h-12 rounded mb-2",style:{backgroundColor:e.hex}}),(0,t.jsx)("p",{className:"text-xs font-mono text-gray-600 dark:text-gray-400",children:e.hex}),(0,t.jsxs)("p",{className:"text-xs text-gray-500",children:[e.confidence,"% ","ar"===l?"ثقة":"confidence"]})]},r))}),y&&(0,t.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-700 rounded-lg mb-6",children:[(0,t.jsx)("h4",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3",children:"ar"===l?"اللون المحدد:":"Selected Color:"}),(0,t.jsxs)("div",{className:"flex items-center space-x-4 rtl:space-x-reverse",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-lg border border-gray-300 dark:border-gray-600",style:{backgroundColor:y.hex}}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-mono text-lg",children:y.hex}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["RGB(",y.rgb.r,", ",y.rgb.g,", ",y.rgb.b,")"]}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:[y.confidence,"% ","ar"===l?"مستوى الثقة":"confidence level"]})]})]})]}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-between space-y-3 sm:space-y-0 sm:space-x-4 rtl:space-x-reverse",children:[(0,t.jsx)(c.z,{variant:"outline",onClick:()=>{p(null),j([]),v(null),S(null)},children:"ar"===l?"تحليل صورة أخرى":"Analyze Another Image"}),(0,t.jsxs)("div",{className:"flex space-x-3 rtl:space-x-reverse",children:[(0,t.jsx)(c.z,{variant:"outline",onClick:i,children:"ar"===l?"إلغاء":"Cancel"}),(0,t.jsxs)(c.z,{onClick:()=>{y&&(n(y.hex),i())},disabled:!y,className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,t.jsx)(h.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"ar"===l?"استخدام هذا اللون":"Use This Color"})]})]})]})]})]}):(0,t.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(k?"border-primary-500 bg-primary-50 dark:bg-primary-950":"border-gray-300 dark:border-gray-600 hover:border-primary-400"),onDragEnter:E,onDragLeave:E,onDragOver:E,onDrop:e=>{e.preventDefault(),e.stopPropagation(),C(!1),e.dataTransfer.files&&e.dataTransfer.files[0]&&z(e.dataTransfer.files[0])},children:[(0,t.jsx)(m.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"ar"===l?"ارفع صورة نتيجة الاختبار":"Upload Test Result Image"}),(0,t.jsx)("p",{className:"text-gray-500 mb-4",children:"ar"===l?"اسحب وأفلت الصورة هنا أو انقر للاختيار":"Drag and drop image here or click to select"}),(0,t.jsxs)(c.z,{onClick:()=>{var e;return null===(e=Z.current)||void 0===e?void 0:e.click()},className:"flex items-center space-x-2 rtl:space-x-reverse mx-auto",children:[(0,t.jsx)(o.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"ar"===l?"اختيار صورة":"Select Image"})]}),(0,t.jsx)("input",{ref:Z,type:"file",accept:"image/*",onChange:e=>{var r;return(null===(r=e.target.files)||void 0===r?void 0:r[0])&&z(e.target.files[0])},className:"hidden"})]}),_&&(0,t.jsx)("div",{className:"mt-4 p-3 bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse text-red-600 dark:text-red-400",children:[(0,t.jsx)(u.Z,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"text-sm",children:_})]})}),(0,t.jsx)("div",{className:"mt-6 p-4 bg-yellow-50 dark:bg-yellow-950 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-start space-x-2 rtl:space-x-reverse",children:[(0,t.jsx)(u.Z,{className:"h-5 w-5 text-yellow-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:[(0,t.jsx)("p",{className:"font-medium mb-1",children:"ar"===l?"تنبيه مهم:":"Important Notice:"}),(0,t.jsx)("p",{children:"ar"===l?"دقة تحليل الألوان تعتمد على جودة الصورة والإضاءة. يُنصح بالتحقق من النتائج يدوياً.":"Color analysis accuracy depends on image quality and lighting. Manual verification is recommended."})]})]})})]})]})})}var b=s(52985),p=s(62047),f=s(20003);let j=e=>({id:e.id,test_id:e.test_id,hex_code:e.color_hex,color_name:{ar:e.color_result_ar,en:e.color_result},substances:{ar:[e.possible_substance_ar],en:[e.possible_substance]},confidence:y(e.confidence_level),confidence_level:e.confidence_level}),y=e=>{switch(e){case"very_high":return 90;case"high":return 80;case"medium":return 65;case"low":return 45;case"very_low":return 25;default:return 50}};function v(e){var r;let{colorResults:s,lang:l,selectedColorResult:i,onColorSelect:x,onComplete:m,notes:y,onNotesChange:v,testId:N}=e,[w,k]=(0,a.useState)([]),[C,_]=(0,a.useState)(!0),[S,Z]=(0,a.useState)(!1);(0,d.nZ)(l),(0,a.useEffect)(()=>{(async()=>{try{if(_(!0),s&&s.length>0)k(s);else{let e=(await n.D.getColorResults()).map(j);k(e)}}catch(e){console.error("Error loading colors:",e)}finally{_(!1)}})()},[s]);let T=e=>e>=85?"text-green-600 bg-green-50 border-green-200":e>=75?"text-green-500 bg-green-50 border-green-200":e>=60?"text-yellow-600 bg-yellow-50 border-yellow-200":e>=40?"text-orange-600 bg-orange-50 border-orange-200":"text-red-600 bg-red-50 border-red-200",R=e=>e>=85?"ar"===l?"عالي جداً":"Very High":e>=75?"ar"===l?"عالي":"High":e>=60?"ar"===l?"متوسط":"Medium":e>=40?"ar"===l?"منخفض":"Low":"ar"===l?"منخفض جداً":"Very Low",z=(e,r)=>{if(0===r.length)return null;let s=I(e);if(!s)return null;let t=r[0],a=1/0;return r.forEach(e=>{let r=I(e.hex_code);if(r){let l=Math.sqrt(Math.pow(s.r-r.r,2)+Math.pow(s.g-r.g,2)+Math.pow(s.b-r.b,2));l<a&&(a=l,t=e)}}),a<100?t:null},I=e=>{let r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:null};return C?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"ar"===l?"جاري تحميل الألوان...":"Loading colors..."})]})}):(0,t.jsxs)("div",{className:"max-w-6xl mx-auto p-6",children:[(0,t.jsxs)("div",{className:"text-center mb-8",children:[(0,t.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary-100 dark:bg-primary-900 mb-4",children:(0,t.jsx)(b.Z,{className:"h-8 w-8 text-primary-600"})}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-foreground mb-2",children:"ar"===l?"اختر اللون المُلاحظ":"Select Observed Color"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"ar"===l?"انقر على اللون الذي لاحظته بعد إضافة الكاشف":"Click on the color you observed after adding the reagent"}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row items-center justify-center space-y-3 sm:space-y-0 sm:space-x-4 rtl:space-x-reverse",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse text-sm text-muted-foreground",children:[(0,t.jsx)(p.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"ar"===l?"اختيار يدوي":"Manual Selection"})]}),(0,t.jsx)("div",{className:"text-muted-foreground",children:"ar"===l?"أو":"or"}),(0,t.jsxs)(c.z,{variant:"outline",onClick:()=>Z(!0),className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,t.jsx)(o.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"ar"===l?"تحليل بالصورة":"Image Analysis"})]})]})]}),(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-8",children:w.map(e=>(0,t.jsx)("div",{onClick:()=>x(e),className:"\n              relative cursor-pointer rounded-lg border-2 p-4 transition-all duration-200 hover:shadow-lg\n              ".concat((null==i?void 0:i.id)===e.id?"border-primary-500 bg-primary-50 dark:bg-primary-950":"border-border bg-background hover:border-primary-300","\n            "),children:(0,t.jsxs)("div",{className:"flex flex-col items-center space-y-3",children:[(0,t.jsx)("div",{className:"w-16 h-16 rounded-full border-4 border-white shadow-lg",style:{backgroundColor:e.hex_code}}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h3",{className:"font-semibold text-foreground text-sm",children:"ar"===l?e.color_name.ar:e.color_name.en}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:e.hex_code})]}),(0,t.jsxs)("div",{className:"px-2 py-1 rounded-full text-xs font-medium border ".concat(T(e.confidence)),children:[e.confidence,"% ",R(e.confidence)]}),(null==i?void 0:i.id)===e.id&&(0,t.jsx)("div",{className:"absolute top-2 right-2",children:(0,t.jsx)(h.Z,{className:"h-6 w-6 text-primary-600"})})]})},e.id))}),i&&(0,t.jsxs)("div",{className:"bg-background border border-border rounded-lg p-6 mb-6",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-4",children:"ar"===l?"تفاصيل اللون المختار":"Selected Color Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3 rtl:space-x-reverse mb-4",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full border-2 border-white shadow",style:{backgroundColor:i.hex_code}}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-foreground",children:"ar"===l?i.color_name.ar:i.color_name.en}),(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:i.hex_code})]})]}),(0,t.jsxs)("div",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium border ".concat(T(i.confidence)),children:[(0,t.jsx)(p.Z,{className:"h-4 w-4 mr-1 rtl:ml-1 rtl:mr-0"}),i.confidence,"% ",R(i.confidence)]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h4",{className:"font-medium text-foreground mb-2",children:"ar"===l?"المواد المحتملة":"Possible Substances"}),(null===(r=i.substances[l])||void 0===r?void 0:r.length)>0?(0,t.jsx)("div",{className:"space-y-1",children:i.substances[l].map((e,r)=>(0,t.jsxs)("div",{className:"flex items-center space-x-2 rtl:space-x-reverse text-sm",children:[(0,t.jsx)("div",{className:"w-2 h-2 rounded-full bg-primary-500"}),(0,t.jsx)("span",{className:"text-muted-foreground",children:e})]},r))}):(0,t.jsx)("p",{className:"text-sm text-muted-foreground",children:"ar"===l?"لا توجد مواد محددة":"No specific substances identified"})]})]})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-foreground mb-2",children:"ar"===l?"ملاحظات إضافية (اختياري)":"Additional Notes (Optional)"}),(0,t.jsx)("textarea",{value:y,onChange:e=>v(e.target.value),placeholder:"ar"===l?"أضف أي ملاحظات حول الاختبار...":"Add any notes about the test...",className:"w-full px-3 py-2 border border-border rounded-lg bg-background text-foreground placeholder-muted-foreground focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none",rows:3})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-sm text-muted-foreground",children:i?(0,t.jsxs)("span",{className:"flex items-center space-x-1 rtl:space-x-reverse text-green-600",children:[(0,t.jsx)(h.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"ar"===l?"تم اختيار اللون":"Color selected"})]}):(0,t.jsxs)("span",{className:"flex items-center space-x-1 rtl:space-x-reverse",children:[(0,t.jsx)(u.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"ar"===l?"يرجى اختيار لون":"Please select a color"})]})}),(0,t.jsxs)(c.z,{onClick:()=>{console.log("View Results clicked, selectedColorResult:",i),i&&m()},disabled:!i,className:"flex items-center space-x-2 rtl:space-x-reverse",children:[(0,t.jsx)("span",{children:"ar"===l?"عرض النتائج":"View Results"}),(0,t.jsx)(f.Z,{className:"h-4 w-4"})]})]}),(0,t.jsx)("div",{className:"mt-6 p-4 bg-warning-50 dark:bg-warning-950 border border-warning-200 dark:border-warning-800 rounded-lg",children:(0,t.jsxs)("div",{className:"flex items-start space-x-2 rtl:space-x-reverse",children:[(0,t.jsx)(u.Z,{className:"h-5 w-5 text-warning-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("div",{className:"text-sm text-warning-700 dark:text-warning-300",children:[(0,t.jsx)("p",{className:"font-medium mb-1",children:"ar"===l?"تنبيه مهم:":"Important Notice:"}),(0,t.jsx)("p",{children:"ar"===l?"اختر اللون الأقرب لما لاحظته. إذا لم تجد اللون المطابق تماماً، اختر الأقرب إليه.":"Select the color closest to what you observed. If you cannot find an exact match, choose the closest one."})]})]})}),S&&(0,t.jsx)(g,{lang:l,testId:N,onColorDetected:e=>{let r=z(e,w);r?x(r):x({id:"custom-".concat(Date.now()),test_id:N,hex_code:e,color_name:{ar:"لون مكتشف من الصورة",en:"Color detected from image"},substances:{ar:["يتطلب تحليل إضافي"],en:["Requires additional analysis"]},confidence:70,confidence_level:"medium"})},onClose:()=>Z(!1)})]})}var N=s(2825),w=s(63002),k=s(33009);function C(e){let{testId:r,lang:s,onComplete:l,onCancel:i}=e,[o,x]=(0,a.useState)(0),[m,g]=(0,a.useState)([]),[p,f]=(0,a.useState)(null),[j,y]=(0,a.useState)([]);(0,d.nZ)(s),(0,a.useEffect)(()=>{(async()=>{let e=await n.D.getChemicalTestById(r);f(e),e&&y(("ar"===s&&e.prepare_ar||e.prepare).split("\n").filter(e=>""!==e.trim()).map(e=>e.replace(/^\d+\.\s*/,"")))})()},[r,s]);let v=[{id:"safety",step:1,title:{ar:"إجراءات السلامة والحماية",en:"Safety and Protection Procedures"},description:{ar:"ارتدِ القفازات المقاومة للمواد الكيميائية ونظارات الأمان الواقية. تأكد من وجود تهوية ممتازة في المكان وإبعاد المواد القابلة للاشتعال.",en:"Wear chemical-resistant gloves and protective safety goggles. Ensure excellent ventilation and remove any flammable materials from the area."},warning:{ar:"خطر: لا تلمس الكواشف الكيميائية مباشرة - قد تسبب حروق كيميائية شديدة",en:"DANGER: Never touch chemical reagents directly - may cause severe chemical burns"},icon:"shield",duration:"3 min"},{id:"preparation",step:2,title:{ar:"تحضير العينة والأدوات",en:"Sample and Equipment Preparation"},description:{ar:"ضع كمية صغيرة جداً من العينة (حجم حبة الأرز) على طبق خزفي أبيض نظيف. استخدم ملقط أو أداة معدنية نظيفة لنقل العينة.",en:"Place a very small amount of sample (rice grain size) on a clean white ceramic plate. Use clean tweezers or metal tool to transfer the sample."},warning:{ar:"تجنب استخدام الأسطح البلاستيكية - قد تتفاعل مع الكواشف",en:"Avoid plastic surfaces - they may react with reagents"},icon:"beaker",duration:"2 min"},{id:"reagent",step:3,title:{ar:"إضافة الكاشف الكيميائي",en:"Add Chemical Reagent"},description:{ar:"باستخدام قطارة زجاجية نظيفة، أضف قطرة واحدة فقط من الكاشف على العينة. أمسك القطارة بزاوية 45 درجة وأضف القطرة ببطء.",en:"Using a clean glass dropper, add exactly one drop of reagent to the sample. Hold the dropper at 45-degree angle and add the drop slowly."},warning:{ar:"تحذير: لا تضع أكثر من قطرة واحدة - قد يؤثر على دقة النتائج",en:"WARNING: Do not add more than one drop - may affect result accuracy"},icon:"eye",duration:"1 min"},{id:"observation",step:4,title:{ar:"مراقبة وتسجيل التفاعل",en:"Observe and Record Reaction"},description:{ar:"راقب تغير اللون فوراً بعد إضافة الكاشف. سجل اللون الأولي الذي يظهر خلال أول 15-30 ثانية. لا تنتظر أكثر من دقيقة واحدة.",en:"Observe color change immediately after adding reagent. Record the initial color that appears within the first 15-30 seconds. Do not wait more than one minute."},warning:{ar:"مهم: اللون الأولي هو الأكثر دقة - التغيرات اللاحقة قد تكون مضللة",en:"IMPORTANT: Initial color is most accurate - later changes may be misleading"},icon:"clock",duration:"1 min"},{id:"cleanup",step:5,title:{ar:"التنظيف والتخلص الآمن",en:"Safe Cleanup and Disposal"},description:{ar:"اتركي العينة والكاشف يجفان تماماً، ثم تخلص منهما في حاوية النفايات الكيميائية المخصصة. اغسل جميع الأدوات بالماء والصابون، ثم اغسل يديك جيداً.",en:"Allow sample and reagent to dry completely, then dispose in designated chemical waste container. Wash all tools with soap and water, then wash hands thoroughly."},warning:{ar:"ممنوع: لا تتخلص من الكواشف في المجاري أو سلة المهملات العادية",en:"PROHIBITED: Never dispose of reagents in drains or regular trash"},icon:"check",duration:"3 min"}],C=(()=>{if(!p||0===j.length)return v;let e=[];return e.push({id:"safety",step:1,title:{ar:"إجراءات السلامة والحماية",en:"Safety and Protection Procedures"},description:{ar:"ارتدِ القفازات المقاومة للمواد الكيميائية ونظارات الأمان الواقية. تأكد من وجود تهوية ممتازة في المكان.",en:"Wear chemical-resistant gloves and protective safety goggles. Ensure excellent ventilation in the area."},warning:{ar:"خطر: ".concat(p.method_name_ar," يتطلب احتياطات خاصة"),en:"DANGER: ".concat(p.method_name," requires special precautions")},icon:"shield",duration:"3 min"}),j.forEach((r,s)=>{e.push({id:"prepare-".concat(s+1),step:s+2,title:{ar:"خطوة ".concat(s+1,": ").concat(r.substring(0,30),"..."),en:"Step ".concat(s+1,": ").concat(r.substring(0,30),"...")},description:{ar:r,en:r},warning:0===s?{ar:"تأكد من استخدام كمية صغيرة جداً من العينة",en:"Ensure to use a very small amount of sample"}:void 0,icon:0===s?"beaker":s===j.length-1?"eye":"clock",duration:"2 min"})}),e.push({id:"cleanup",step:e.length+1,title:{ar:"التنظيف والتخلص الآمن",en:"Cleanup and Safe Disposal"},description:{ar:"تخلص من جميع المواد بطريقة آمنة واغسل يديك جيداً.",en:"Dispose of all materials safely and wash hands thoroughly."},warning:{ar:"لا تتخلص من الكواشف في المجاري العادية",en:"Never dispose of reagents in regular drains"},icon:"check",duration:"3 min"}),e})(),_=e=>{switch(e){case"shield":return(0,t.jsx)(N.Z,{className:"h-6 w-6"});case"beaker":return(0,t.jsx)(w.Z,{className:"h-6 w-6"});case"eye":return(0,t.jsx)(b.Z,{className:"h-6 w-6"});case"clock":return(0,t.jsx)(k.Z,{className:"h-6 w-6"});case"check":return(0,t.jsx)(h.Z,{className:"h-6 w-6"});default:return(0,t.jsx)(u.Z,{className:"h-6 w-6"})}},S=e=>{let r=[...m];r[e]=!0,g(r),e<C.length-1&&x(e+1)},Z=m.length===C.length&&m.every(e=>!0===e);return(0,t.jsxs)("div",{className:"max-w-4xl mx-auto p-6",children:[(0,t.jsxs)("div",{className:"text-center mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-foreground mb-2",children:"ar"===s?"تعليمات الاختبار الكيميائي":"Chemical Test Instructions"}),(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"ar"===s?"اتبع هذه الخطوات بدقة وحذر شديد لضمان سلامتك الشخصية والحصول على نتائج موثوقة ودقيقة":"Follow these steps precisely and with extreme caution to ensure your personal safety and obtain reliable, accurate results"}),(0,t.jsx)("div",{className:"mb-4 p-4 bg-red-50 dark:bg-red-950 border border-red-200 dark:border-red-800 rounded-lg",children:(0,t.jsx)("p",{className:"text-sm text-red-800 dark:text-red-200 font-bold",children:"ar"===s?"⚠️ تحذير مهم: هذه الاختبارات للمتخصصين المدربين فقط في بيئة مختبرية آمنة ومجهزة":"⚠️ IMPORTANT WARNING: These tests are for trained professionals only in a safe, equipped laboratory environment"})})]}),(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-sm font-medium text-foreground",children:"ar"===s?"التقدم":"Progress"}),(0,t.jsxs)("span",{className:"text-sm text-muted-foreground",children:[m.filter(Boolean).length," / ",C.length]})]}),(0,t.jsx)("div",{className:"w-full bg-secondary rounded-full h-2",children:(0,t.jsx)("div",{className:"bg-primary h-2 rounded-full transition-all duration-300",style:{width:"".concat(m.filter(Boolean).length/C.length*100,"%")}})})]}),(0,t.jsx)("div",{className:"space-y-6",children:C.map((e,r)=>(0,t.jsx)("div",{className:"\n              border rounded-lg p-6 transition-all duration-300\n              ".concat(r===o?"border-primary bg-primary-50 dark:bg-primary-950":m[r]?"border-green-500 bg-green-50 dark:bg-green-950":"border-border bg-background","\n              ").concat(r>o?"opacity-50":"opacity-100","\n            "),children:(0,t.jsxs)("div",{className:"flex items-start space-x-4 rtl:space-x-reverse",children:[(0,t.jsx)("div",{className:"\n                flex-shrink-0 w-12 h-12 rounded-full flex items-center justify-center\n                ".concat(m[r]?"bg-green-500 text-white":r===o?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground","\n              "),children:m[r]?(0,t.jsx)(h.Z,{className:"h-6 w-6"}):_(e.icon)}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-foreground",children:"ar"===s?"".concat(e.step,". ").concat(e.title.ar):"".concat(e.step,". ").concat(e.title.en)}),e.duration&&(0,t.jsx)("span",{className:"text-sm text-muted-foreground bg-secondary px-2 py-1 rounded",children:e.duration})]}),(0,t.jsx)("p",{className:"text-muted-foreground mb-4",children:"ar"===s?e.description.ar:e.description.en}),e.warning&&(0,t.jsxs)("div",{className:"flex items-start space-x-2 rtl:space-x-reverse p-3 bg-warning-50 dark:bg-warning-950 border border-warning-200 dark:border-warning-800 rounded-lg mb-4",children:[(0,t.jsx)(u.Z,{className:"h-5 w-5 text-warning-600 mt-0.5 flex-shrink-0"}),(0,t.jsxs)("p",{className:"text-sm text-warning-700 dark:text-warning-300",children:[(0,t.jsx)("strong",{children:"ar"===s?"تحذير: ":"Warning: "}),"ar"===s?e.warning.ar:e.warning.en]})]}),r===o&&!m[r]&&(0,t.jsx)(c.z,{onClick:()=>S(r),className:"mt-4",children:"ar"===s?"تم إكمال هذه الخطوة":"Complete This Step"}),m[r]&&(0,t.jsxs)("div",{className:"mt-4 flex items-center space-x-2 rtl:space-x-reverse text-green-600",children:[(0,t.jsx)(h.Z,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"ar"===s?"تم إكمال هذه الخطوة":"Step Completed"})]})]})]})},e.id))}),(0,t.jsxs)("div",{className:"flex items-center justify-between mt-8 pt-6 border-t border-border",children:[(0,t.jsx)(c.z,{variant:"outline",onClick:i,children:"ar"===s?"إلغاء":"Cancel"}),(0,t.jsx)(c.z,{onClick:()=>{l()},disabled:!Z,className:Z?"bg-green-600 hover:bg-green-700":"",children:"ar"===s?"بدء الاختبار":"Start Test"})]})]})}var _=s(48059),S=s.n(_),Z=s(28100),T=s(18882),R=s(66514);function z(e){var r,s;let{testId:i,selectedColor:o,lang:x,onBack:m,onNewTest:g}=e,[p,f]=(0,a.useState)(null),[j,y]=(0,a.useState)(null),[v,N]=(0,a.useState)(!0),[C,_]=(0,a.useState)(!1),z=(0,l.useRouter)();(0,d.nZ)(x),(0,a.useEffect)(()=>{let e=async()=>{try{var e;N(!0);let r=await n.D.getChemicalTestById(i),s=(await n.D.getColorResults()).find(e=>e.test_id===i&&e.color_hex===o);if(!r)throw Error("Test data not found");y(r),s||console.warn("Color result not found, creating generic result");let t={id:"".concat(i,"-").concat(o,"-").concat(Date.now()),testId:i,colorId:o,confidence:s?(e=>{switch(e){case"very_high":return 95;case"high":return 85;case"medium":return 75;case"low":return 60;case"very_low":return 40;default:return 50}})(s.confidence_level):50,substances:s?(e="ar"===x?s.possible_substance_ar:s.possible_substance)?e.split(",").map(e=>e.trim()).filter(e=>e.length>0):[]:["ar"===x?"غير محدد":"Unknown"],timestamp:new Date,colorName:s?"ar"===x?s.color_result_ar:s.color_result:"",colorHex:o};f(t);let a=JSON.parse(localStorage.getItem("test_results")||"[]");a.push(t),localStorage.setItem("test_results",JSON.stringify(a)),_(!0)}catch(e){console.error("Error loading test result:",e)}finally{N(!1)}};i&&o&&e()},[i,o,x]);let I=async()=>{if(navigator.share&&p)try{await navigator.share({title:"ar"===x?"نتيجة اختبار الألوان":"Color Test Result",text:"".concat("ar"===x?"نتيجة الاختبار":"Test Result",": ").concat(p.confidence,"% ").concat("ar"===x?"ثقة":"confidence"),url:window.location.href})}catch(e){console.log("Error sharing:",e)}else{let e="".concat("ar"===x?"نتيجة اختبار الألوان":"Color Test Result",": ").concat(null==p?void 0:p.confidence,"% ").concat("ar"===x?"ثقة":"confidence");navigator.clipboard.writeText(e)}};if(v)return(0,t.jsx)("div",{className:"flex items-center justify-center min-h-[400px]",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-500",children:"ar"===x?"جاري تحليل النتائج...":"Analyzing results..."})]})});if(!p)return(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)(u.Z,{className:"h-12 w-12 text-warning-500 mx-auto mb-4"}),(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2",children:"ar"===x?"خطأ في تحميل النتائج":"Error Loading Results"}),(0,t.jsx)("p",{className:"text-gray-500 mb-4",children:"ar"===x?"حدث خطأ أثناء تحليل النتائج":"An error occurred while analyzing the results"}),(0,t.jsx)(c.z,{onClick:m,children:"ar"===x?"العودة":"Go Back"})]});let D=(r=p.confidence)>=90?{level:"very-high",color:"text-green-700",bg:"bg-green-50 border-green-200 dark:bg-green-950 dark:border-green-800"}:r>=80?{level:"high",color:"text-green-600",bg:"bg-green-50 border-green-200 dark:bg-green-950 dark:border-green-800"}:r>=70?{level:"medium",color:"text-yellow-600",bg:"bg-yellow-50 border-yellow-200 dark:bg-yellow-950 dark:border-yellow-800"}:{level:"low",color:"text-red-600",bg:"bg-red-50 border-red-200 dark:bg-red-950 dark:border-red-800"};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(S(),{id:"37f97144117bd4ce",children:"@media print{body.jsx-37f97144117bd4ce{font-size:10pt!important;line-height:1.4!important;color:black!important}.print\\\\.jsx-37f97144117bd4ce:hidden{display:none!important}.print\\\\.jsx-37f97144117bd4ce:text-4xl{font-size:2rem!important}.print\\\\.jsx-37f97144117bd4ce:text-base{font-size:.875rem!important}.print\\\\.jsx-37f97144117bd4ce:p-4{padding:1rem!important}.print\\\\.jsx-37f97144117bd4ce:shadow-none{-webkit-box-shadow:none!important;-moz-box-shadow:none!important;box-shadow:none!important}.print\\\\.jsx-37f97144117bd4ce:border-gray-400{border-color:#9ca3af!important}.print\\\\.jsx-37f97144117bd4ce:mb-2{margin-bottom:.5rem!important}.print\\\\.jsx-37f97144117bd4ce:mb-4{margin-bottom:1rem!important}.print\\\\.jsx-37f97144117bd4ce:text-sm{font-size:.75rem!important}h1.jsx-37f97144117bd4ce{font-size:1.5rem!important;margin-bottom:.5rem!important}h2.jsx-37f97144117bd4ce{font-size:1.25rem!important;margin-bottom:.5rem!important}h3.jsx-37f97144117bd4ce{font-size:1.125rem!important;margin-bottom:.25rem!important}.max-w-4xl.jsx-37f97144117bd4ce{max-width:100%!important}.p-6.jsx-37f97144117bd4ce{padding:1rem!important}.mb-8.jsx-37f97144117bd4ce{margin-bottom:1rem!important}.space-y-3.jsx-37f97144117bd4ce>*.jsx-37f97144117bd4ce+*.jsx-37f97144117bd4ce{margin-top:.5rem!important}.space-y-2.jsx-37f97144117bd4ce>*.jsx-37f97144117bd4ce+*.jsx-37f97144117bd4ce{margin-top:.25rem!important}}"}),(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce max-w-4xl mx-auto p-6 print:p-4 print:max-w-full",children:[(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce text-center mb-8 print:mb-4",children:[(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce inline-flex items-center justify-center w-16 h-16 rounded-full bg-primary-100 dark:bg-primary-900 mb-4 print:mb-2 print:w-12 print:h-12",children:(0,t.jsx)(h.Z,{className:"h-8 w-8 text-primary-600 print:h-6 print:w-6"})}),(0,t.jsx)("h1",{className:"jsx-37f97144117bd4ce text-3xl font-bold text-gray-900 dark:text-gray-100 mb-2 print:text-xl print:mb-1",children:"ar"===x?"نتائج الاختبار":"Test Results"}),(0,t.jsx)("p",{className:"jsx-37f97144117bd4ce text-gray-500 print:text-sm",children:"ar"===x?"تم تحليل العينة بنجاح":"Sample analysis completed successfully"})]}),(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce bg-white border border-gray-300 rounded-xl shadow-lg mb-8 dark:bg-gray-800 dark:border-gray-600 print:shadow-none print:border-gray-400",children:[(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce border-b border-gray-200 dark:border-gray-700 p-6 print:p-4",children:(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce flex items-center space-x-4 rtl:space-x-reverse",children:[(0,t.jsx)(w.Z,{className:"h-10 w-10 text-primary-600 flex-shrink-0"}),(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce",children:[(0,t.jsx)("h3",{className:"jsx-37f97144117bd4ce font-semibold text-gray-900 dark:text-gray-100 text-lg",children:"ar"===x?"نوع الاختبار":"Test Type"}),(0,t.jsxs)("p",{className:"jsx-37f97144117bd4ce text-gray-600 dark:text-gray-400",children:[(null==j?void 0:j["ar"===x?"method_name_ar":"method_name"])||i.charAt(0).toUpperCase()+i.slice(1)," Test"]})]})]}),(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce flex items-center space-x-4 rtl:space-x-reverse",children:[(0,t.jsx)(k.Z,{className:"h-10 w-10 text-primary-600 flex-shrink-0"}),(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce",children:[(0,t.jsx)("h3",{className:"jsx-37f97144117bd4ce font-semibold text-gray-900 dark:text-gray-100 text-lg",children:"ar"===x?"وقت الاختبار":"Test Time"}),(0,t.jsx)("p",{className:"jsx-37f97144117bd4ce text-gray-600 dark:text-gray-400",children:p.timestamp.toLocaleString("ar"===x?"ar-SA":"en-US")})]})]})]})}),(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce border-b border-gray-200 dark:border-gray-700 p-6 print:p-4",children:[(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce flex items-center space-x-4 rtl:space-x-reverse mb-4",children:[(0,t.jsx)(b.Z,{className:"h-8 w-8 text-primary-600"}),(0,t.jsx)("h3",{className:"jsx-37f97144117bd4ce text-xl font-semibold text-gray-900 dark:text-gray-100",children:"ar"===x?"اللون المُلاحظ":"Observed Color"})]}),(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce bg-gray-50 dark:bg-gray-700 rounded-lg p-4",children:(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce flex items-center justify-between",children:(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce flex items-center space-x-4 rtl:space-x-reverse",children:[(0,t.jsx)("div",{style:{backgroundColor:o},className:"jsx-37f97144117bd4ce w-12 h-12 rounded-lg border-2 border-gray-300 dark:border-gray-600 shadow-sm"}),(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce",children:[(0,t.jsx)("p",{className:"jsx-37f97144117bd4ce font-medium text-gray-900 dark:text-gray-100",children:p.colorName||("ar"===x?"لون مخصص":"Custom Color")}),(0,t.jsx)("p",{className:"jsx-37f97144117bd4ce text-sm text-gray-500 dark:text-gray-400 font-mono",children:o})]})]})})})]}),(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce border-b border-gray-200 dark:border-gray-700 p-6 print:p-4",children:[(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce flex items-center space-x-3 rtl:space-x-reverse mb-4",children:[(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce w-8 h-8 rounded-full bg-primary-100 dark:bg-primary-900 flex items-center justify-center",children:(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce w-4 h-4 rounded-full bg-primary-600"})}),(0,t.jsx)("h3",{className:"jsx-37f97144117bd4ce text-xl font-semibold text-gray-900 dark:text-gray-100",children:"ar"===x?"المواد المحتملة":"Possible Substances"})]}),p.substances.length>0?(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce space-y-3",children:p.substances.map((e,r)=>(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce flex items-center space-x-4 rtl:space-x-reverse p-4 bg-primary-50 dark:bg-primary-950 border border-primary-200 dark:border-primary-800 rounded-lg",children:[(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce w-3 h-3 rounded-full bg-primary-600 flex-shrink-0"}),(0,t.jsx)("span",{className:"jsx-37f97144117bd4ce text-gray-900 dark:text-gray-100 font-medium text-lg",children:e})]},r))}):(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:(0,t.jsx)("p",{className:"jsx-37f97144117bd4ce text-gray-500 dark:text-gray-400 text-center",children:"ar"===x?"لا توجد مواد محددة لهذا اللون":"No specific substances identified for this color"})})]}),(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce "+"border-b border-gray-200 dark:border-gray-700 p-6 print:p-4 ".concat(D.bg),children:(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce text-center",children:[(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce flex items-center justify-center space-x-3 rtl:space-x-reverse mb-4",children:[(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce "+"w-8 h-8 rounded-full flex items-center justify-center ".concat(D.color.replace("text-","bg-").replace("-600","-100")," ").concat(D.color.replace("text-","border-").replace("-600","-300")," border-2"),children:(0,t.jsx)(h.Z,{className:"h-5 w-5 ".concat(D.color)})}),(0,t.jsx)("h3",{className:"jsx-37f97144117bd4ce text-xl font-semibold text-gray-900 dark:text-gray-100",children:"ar"===x?"مستوى الثقة":"Confidence Level"})]}),(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce space-y-2",children:[(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce "+"text-5xl font-bold ".concat(D.color," print:text-4xl"),children:[p.confidence,"%"]}),(0,t.jsx)("p",{className:"jsx-37f97144117bd4ce "+"text-lg font-semibold ".concat(D.color," print:text-base"),children:(s=p.confidence)>=90?"ar"===x?"عالي جداً":"Very High":s>=80?"ar"===x?"عالي":"High":s>=70?"ar"===x?"متوسط":"Medium":"ar"===x?"منخفض":"Low"}),(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce mt-4 bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden",children:(0,t.jsx)("div",{style:{width:"".concat(p.confidence,"%")},className:"jsx-37f97144117bd4ce "+"h-full transition-all duration-500 ".concat(D.color.replace("text-","bg-"))})})]})]})}),(()=>{let e=null==j?void 0:j.reference;return e?(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce p-6 print:p-4 bg-blue-50 dark:bg-blue-900/20 border-t border-blue-200 dark:border-blue-800",children:[(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce flex items-center space-x-3 rtl:space-x-reverse mb-4",children:[(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center",children:(0,t.jsx)("svg",{fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",className:"jsx-37f97144117bd4ce w-5 h-5 text-white",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253",className:"jsx-37f97144117bd4ce"})})}),(0,t.jsx)("h3",{className:"jsx-37f97144117bd4ce text-xl font-bold text-blue-900 dark:text-blue-100",children:"ar"===x?"المرجع العلمي":"Scientific Reference"})]}),(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce bg-white dark:bg-gray-800 rounded-lg p-5 border-2 border-blue-200 dark:border-blue-700 shadow-sm",children:(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce flex items-start space-x-3 rtl:space-x-reverse",children:[(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce w-6 h-6 rounded-full bg-blue-100 dark:bg-blue-800 flex items-center justify-center flex-shrink-0 mt-0.5",children:(0,t.jsx)("svg",{fill:"currentColor",viewBox:"0 0 20 20",className:"jsx-37f97144117bd4ce w-3 h-3 text-blue-600 dark:text-blue-300",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 0v12h8V4H6z",clipRule:"evenodd",className:"jsx-37f97144117bd4ce"})})}),(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce flex-1",children:(0,t.jsx)("p",{className:"jsx-37f97144117bd4ce text-sm text-blue-900 dark:text-blue-100 font-medium leading-relaxed",children:e})})]})})]}):null})()]}),(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce flex flex-col space-y-6 print:hidden",children:[(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce text-center",children:[(0,t.jsxs)(c.z,{onClick:()=>{console.log("Perform Another Test clicked - navigating to tests page"),z.push("/".concat(x,"/tests"))},size:"lg",className:"bg-blue-600 hover:bg-blue-700 text-white font-semibold px-8 py-3 text-lg flex items-center space-x-3 rtl:space-x-reverse mx-auto shadow-lg hover:shadow-xl transition-all duration-200",children:[(0,t.jsx)(w.Z,{className:"h-6 w-6 text-white"}),(0,t.jsx)("span",{className:"jsx-37f97144117bd4ce",children:"ar"===x?"إجراء اختبار آخر":"Perform Another Test"})]}),(0,t.jsx)("p",{className:"jsx-37f97144117bd4ce text-sm text-gray-500 mt-2",children:"ar"===x?"ابدأ اختبار جديد بنوع مختلف من الكواشف":"Start a new test with a different type of reagent"})]}),(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce flex flex-col sm:flex-row items-center justify-center space-y-3 sm:space-y-0 sm:space-x-4 rtl:space-x-reverse",children:[(0,t.jsxs)(c.z,{variant:"outline",onClick:()=>{window.print()},className:"flex items-center space-x-2 rtl:space-x-reverse hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,t.jsx)(Z.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"jsx-37f97144117bd4ce",children:"ar"===x?"طباعة التقرير":"Print Report"})]}),(0,t.jsxs)(c.z,{variant:"outline",onClick:I,className:"flex items-center space-x-2 rtl:space-x-reverse hover:bg-gray-50 dark:hover:bg-gray-800",children:[(0,t.jsx)(T.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"jsx-37f97144117bd4ce",children:"ar"===x?"مشاركة النتائج":"Share Results"})]})]}),(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce flex justify-center border-t border-gray-200 dark:border-gray-700 pt-4",children:(0,t.jsxs)(c.z,{variant:"ghost",onClick:()=>{console.log("Back to color selection clicked"),m?m():z.back()},className:"flex items-center space-x-2 rtl:space-x-reverse text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-200",children:[(0,t.jsx)(R.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{className:"jsx-37f97144117bd4ce",children:"ar"===x?"العودة لاختيار اللون":"Back to Color Selection"})]})})]}),C&&(0,t.jsx)("div",{className:"jsx-37f97144117bd4ce mt-4 p-3 bg-green-50 dark:bg-green-950 border border-green-200 dark:border-green-800 rounded-lg print:hidden",children:(0,t.jsxs)("div",{className:"jsx-37f97144117bd4ce flex items-center space-x-2 rtl:space-x-reverse text-green-600",children:[(0,t.jsx)(h.Z,{className:"h-5 w-5"}),(0,t.jsx)("span",{className:"jsx-37f97144117bd4ce text-sm font-medium",children:"ar"===x?"تم حفظ النتائج بنجاح":"Results saved successfully"})]})})]})]})}var I=s(88726);let D=e=>({id:e.id,test_id:e.test_id,hex_code:e.color_hex,color_name:{ar:e.color_result_ar,en:e.color_result},substances:{ar:[e.possible_substance_ar],en:[e.possible_substance]},confidence:P(e.confidence_level),confidence_level:e.confidence_level}),P=e=>{switch(e){case"very_high":return 90;case"high":return 80;case"medium":return 65;case"low":return 45;case"very_low":return 25;default:return 50}};function E(e){let{lang:r,testId:s}=e,[d,o]=(0,a.useState)(null),[x,m]=(0,a.useState)([]),[g,b]=(0,a.useState)([]),[p,f]=(0,a.useState)("instructions"),[j,y]=(0,a.useState)(null),[N,_]=(0,a.useState)(null),[S,Z]=(0,a.useState)(!0),[T,P]=(0,a.useState)(.5),[E,A]=(0,a.useState)(""),M=(0,l.useRouter)();(0,a.useEffect)(()=>{(async()=>{try{let e=await n.D.getChemicalTestById(s);if(!e){I.ZP.error("ar"===r?"خطأ في تحميل البيانات":"Error loading data"),M.push("/".concat(r,"/tests"));return}let t=await n.D.getColorResultsByTestId(s),a=await n.D.getTestInstructionsByTestId(s);o(e),m(t.map(D)),b(a);let l=n.D.createTestSession(s);_(l)}catch(e){console.error("Error loading test data:",e),I.ZP.error("ar"===r?"خطأ في تحميل البيانات":"Error loading data")}finally{Z(!1)}})()},[s,r,M]);let B=e=>{switch(e){case"instructions":f("color-selection");break;case"color-selection":if(j&&N)try{n.D.completeTestSession(N.id,j.id,T,E)?(f("results"),I.ZP.success("ar"===r?"تم إكمال الاختبار بنجاح":"Test completed successfully")):(f("results"),I.ZP.success("ar"===r?"تم إكمال الاختبار":"Test completed"))}catch(e){console.error("Error completing test session:",e),f("results"),I.ZP.success("ar"===r?"تم إكمال الاختبار":"Test completed")}else I.ZP.error("ar"===r?"يرجى اختيار لون أولاً":"Please select a color first");break;case"results":M.push("/".concat(r,"/tests"))}};if(S)return(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)(i.T,{size:"lg"})});if(!d)return(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-foreground mb-4",children:"ar"===r?"خطأ":"Error"}),(0,t.jsx)(c.z,{onClick:()=>M.push("/".concat(r,"/tests")),children:"ar"===r?"العودة":"Back"})]})});let O="ar"===r?d.method_name_ar:d.method_name,L="ar"===r?d.description_ar:d.description,H=(e=>{switch(e){case"instructions":return u.Z;case"color-selection":return w.Z;case"results":return h.Z}})(p);return(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-primary-50 via-white to-secondary-50 dark:from-primary-950 dark:via-background dark:to-secondary-950",children:(0,t.jsxs)("div",{className:"container mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsxs)(c.z,{variant:"ghost",onClick:()=>{console.log("Back button clicked - navigating to tests page"),M.push("/".concat(r,"/tests"))},className:"mb-4",children:[(0,t.jsx)(R.Z,{className:"h-4 w-4 mr-2 rtl:ml-2 rtl:mr-0 rtl:rotate-180"}),"ar"===r?"العودة":"Back"]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-full mb-4",style:{backgroundColor:"".concat(d.color_primary,"20")},children:(0,t.jsx)(H,{className:"h-8 w-8",style:{color:d.color_primary}})}),(0,t.jsx)("h1",{className:"text-3xl md:text-4xl font-bold text-foreground mb-2",children:O}),(0,t.jsx)("p",{className:"text-lg text-muted-foreground mb-4",children:L}),(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-4 rtl:space-x-reverse text-sm text-muted-foreground",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(k.Z,{className:"h-4 w-4 mr-1 rtl:ml-1 rtl:mr-0"}),d.preparation_time," ","ar"===r?"دقيقة":"minutes"]}),(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(u.Z,{className:"h-4 w-4 mr-1 rtl:ml-1 rtl:mr-0"}),"high"===d.safety_level?"ar"===r?"عالي":"High":"medium"===d.safety_level?"ar"===r?"متوسط":"Medium":"ar"===r?"منخفض":"Low"]})]})]})]}),(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("div",{className:"flex items-center justify-center space-x-4 rtl:space-x-reverse",children:["instructions","color-selection","results"].map((e,r)=>{let s=p===e,a=["instructions","color-selection","results"].indexOf(p)>r;return(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ".concat(s?"bg-primary-600 text-white":a?"bg-success-600 text-white":"bg-muted text-muted-foreground"),children:r+1}),r<2&&(0,t.jsx)("div",{className:"w-12 h-0.5 mx-2 ".concat(a?"bg-success-600":"bg-muted")})]},e)})}),(0,t.jsx)("div",{className:"text-center mt-4",children:(0,t.jsx)("h2",{className:"text-xl font-semibold text-foreground",children:(e=>{switch(e){case"instructions":return"ar"===r?"تعليمات السلامة":"Safety Instructions";case"color-selection":return"ar"===r?"اختيار اللون المُلاحظ":"Select Observed Color";case"results":return"ar"===r?"النتائج":"Results"}})(p)})})]}),(0,t.jsxs)("div",{className:"max-w-4xl mx-auto",children:["instructions"===p&&(0,t.jsx)(C,{testId:s,lang:r,onComplete:()=>B("instructions"),onCancel:()=>{console.log("Test instructions cancelled - navigating to tests page"),M.push("/".concat(r,"/tests"))}}),"color-selection"===p&&(0,t.jsx)(v,{colorResults:x,lang:r,selectedColorResult:j,onColorSelect:e=>{y(e),P({very_low:.2,low:.4,medium:.6,high:.8,very_high:.9}[e.confidence_level]||.5)},onComplete:()=>B("color-selection"),notes:E,onNotesChange:A,testId:s}),"results"===p&&j&&(0,t.jsx)(z,{testId:s,selectedColor:j.hex_code,lang:r,onBack:()=>f("color-selection"),onNewTest:()=>{console.log("New test requested - navigating to tests page"),M.push("/".concat(r,"/tests"))}})]})]})})}}},function(e){e.O(0,[358,990,868,609,695,261,772,673,971,23,744],function(){return e(e.s=33363)}),_N_E=e.O()}]);